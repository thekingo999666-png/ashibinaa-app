<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>店内注文 - あしびなぁ</title>

<!-- CSS 読み込み -->
<link rel="stylesheet" href="style.css" />
</head>

<body>

<!-- 席選択 -->
<div id="seatBox">
  <label>席：</label>
  <select id="seatSelect">
    <option value="">選択してください</option>
    <option value="カウンター1">カウンター1</option>
    <option value="カウンター2">カウンター2</option>
    <option value="カウンター3">カウンター3</option>
    <option value="テーブル1">テーブル1</option>
    <option value="テーブル2">テーブル2</option>
    <option value="座敷1">座敷1</option>
  </select>
</div>

<div id="container">
  <!-- 左：カテゴリ -->
  <div id="categoryList"></div>

  <!-- 中央：メニュー -->
  <div id="menuList"></div>

  <!-- 右：カート -->
  <div id="cartBox">
    <h3>注文内容</h3>
    <div id="cartItems"></div>
    <div id="cartTotal">合計: ¥0</div>
    <button id="sendBtn">注文送信</button>
  </div>
</div>

<!-- モーダル -->
<div id="modalOverlay">
  <div id="modalBox">
    <div id="modalTitle"></div>
    <div id="modalPrice"></div>

    <div id="modalOptions"></div>

    <div class="qtyBox">
      <button class="qtyBtn" id="qtyMinus">－</button>
      <span id="qtyNumber">1</span>
      <button class="qtyBtn" id="qtyPlus">＋</button>
    </div>

    <textarea id="memoInput" placeholder="メモ（氷少なめ、薄め等）"></textarea>

    <button id="addCartBtn">カートに追加</button>
    <button id="closeModalBtn">閉じる</button>
  </div>
</div>

<!-- JS -->
<script src="script.js"></script>

</body>
</html>
/* ===============================
   基本設定
=============================== */
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic", sans-serif;
  background: #0b0c10;
  color: #fff;
}

#seatBox {
  padding: 12px;
  background: #101820;
  border-bottom: 1px solid #333;
  font-size: 1rem;
}

#seatSelect {
  padding: 6px;
  border-radius: 6px;
  font-size: 1rem;
}

/* ===============================
   レイアウト（PC 3カラム）
=============================== */
#container {
  display: flex;
  height: calc(100vh - 60px);
  overflow: hidden;
}

#categoryList {
  width: 20%;
  background: #111;
  border-right: 1px solid #333;
  overflow-y: auto;
}

#menuList {
  width: 50%;
  padding: 10px;
  overflow-y: auto;
}

#cartBox {
  width: 30%;
  background: #151515;
  border-left: 1px solid #333;
  padding: 12px;
  overflow-y: auto;
}

/* ===============================
   カテゴリ
=============================== */
.category-item {
  padding: 14px;
  border-bottom: 1px solid #222;
  cursor: pointer;
  font-size: 1.1rem;
}

.category-item.active {
  background: #f5b542;
  color: #111;
  font-weight: bold;
}

/* ===============================
   メニュー
=============================== */
.menu-item {
  background: #1a1a1a;
  border: 1px solid #333;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 10px;
  cursor: pointer;
}

.menu-title {
  font-size: 1.1rem;
  font-weight: bold;
}

.menu-price {
  float: right;
  color: #f5b542;
}

/* ===============================
   カート
=============================== */
#cartItems {
  margin-bottom: 14px;
}

.cart-row {
  padding: 10px;
  border-bottom: 1px solid #333;
}

#cartTotal {
  font-size: 1.2rem;
  margin-top: 12px;
}

#sendBtn {
  width: 100%;
  padding: 12px;
  background: #06c755;
  color: #fff;
  border: none;
  margin-top: 14px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1.1rem;
}

/* ===============================
   モーダル
=============================== */
#modalOverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index: 999;
}

#modalBox {
  background: #1a1a1a;
  width: 90%;
  max-width: 420px;
  padding: 20px;
  border-radius: 12px;
  border: 1px solid #444;
}

#modalTitle {
  font-size: 1.3rem;
  font-weight: bold;
}

#modalPrice {
  font-size: 1.1rem;
  margin-top: 6px;
  color: #f5b542;
}

.qtyBox {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 12px;
}

.qtyBtn {
  padding: 8px 14px;
  background: #333;
  border: none;
  color: #fff;
  border-radius: 6px;
  font-size: 1.2rem;
}

#qtyNumber {
  margin: 0 16px;
  font-size: 1.3rem;
}

#memoInput {
  width: 100%;
  height: 60px;
  margin-top: 12px;
  padding: 8px;
  border-radius: 8px;
  font-size: 1rem;
}

.option-btn {
  display: inline-block;
  background: #333;
  padding: 8px 14px;
  border-radius: 6px;
  margin: 5px;
  cursor: pointer;
  border: 1px solid #555;
}

.option-btn.active {
  background: #f5b542;
  color: #111;
}

/* モーダル下部ボタン */
#addCartBtn {
  width: 100%;
  padding: 12px;
  margin-top: 14px;
  background: #f5b542;
  border: none;
  color: #111;
  font-size: 1.1rem;
  border-radius: 8px;
}

#closeModalBtn {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  background: #444;
  border: none;
  color: #fff;
  font-size: 1.1rem;
  border-radius: 8px;
}

/* ===============================
   スマホ最適化
=============================== */
@media (max-width: 768px) {
  #container {
    display: block;
    height: auto;
  }

  #categoryList,
  #menuList,
  #cartBox {
    width: 100%;
    height: auto;
  }

  #cartBox {
    margin-top: 12px;
  }

  .menu-item {
    font-size: 1rem;
  }

  .category-item {
    font-size: 1rem;
  }
}
/* ===============================
   データベース（カテゴリ → メニュー）
=============================== */

const categories = [
  "オススメ",
  "さっぱり",
  "チャンプル",
  "シリシリ",
  "玉子",
  "唐揚げ",
  "揚げ物",
  "天ぷら",
  "島そばで",
  "男爺のつまみ",
  "ご飯",
  "そば",
  "リゾット",
  "ビール",
  "ハイボール",
  "サワー",
  "茶割り",
  "焼酎",
  "泡盛（本島）",
  "泡盛（八重山）",
  "石垣のお酒",
  "リキュール"
];

/* ===============================
   メニュー一覧
=============================== */
const menuData = {
  "オススメ": [
    { n: "石垣牛ハンバーグ", p: 1600 },
    { n: "ざるもずく", p: 800 },
    { n: "もずくキムチ", p: 600 }
  ],

  "さっぱり": [
    { n: "島らっきょ", p: 500 },
    { n: "島らっきょクリームチーズベーコン", p: 700 },
    { n: "梅水晶", p: 500 },
    { n: "ゴーヤスライス", p: 400 },
    { n: "塩辛", p: 300 },
    { n: "塩辛3種盛り", p: 600 },
    { n: "海ぶどう", p: 600 }
  ],

  "チャンプル": [
    { n: "ゴーヤチャンプル", p: 800 },
    { n: "ソーメンチャンプル", p: 800 },
    { n: "豆腐チャンプル", p: 800 },
    { n: "フーチャンプル", p: 800 },
    { n: "らっきょチャンプル", p: 800 },
    { n: "カラシナチャンプル", p: 800 }
  ],

  "シリシリ": [
    { n: "人参シリシリ", p: 600 },
    { n: "パパイヤシリシリ", p: 600 }
  ],

  "玉子": [
    { n: "ポーク玉子", p: 700 },
    { n: "だし巻き", p: 600 },
    { n: "目玉焼き", p: 600 }
  ],

  "唐揚げ": [
    { n: "鶏の唐揚げ", p: 600 },
    { n: "タコ唐揚げ", p: 500 },
    { n: "イカ唐揚げ", p: 500 },
    { n: "エビ唐揚げ", p: 500 },
    { n: "チーズの棒", p: 500 }
  ],

  "揚げ物": [
    { n: "カーリーフライ", p: 600 },
    { n: "タコスボール", p: 600 }
  ],

  "天ぷら": [
    { n: "お任せ３種", p: 1000 },
    { n: "お任せ５種", p: 1500 }
  ],

  "島そばで": [
    { n: "ピリ辛エビトマト", p: 800 },
    { n: "ぽなペティート", p: 800 },
    { n: "あぐ〜ペペロン", p: 800 },
    { n: "本日の気まぐれ", p: 800 },
    { n: "島焼きそば（塩）", p: 800 },
    { n: "島焼きそば（シークヮーサー）", p: 800 }
  ],

  "男爺のつまみ": [
    { n: "たちつてと", p: 700 },
    { n: "ポチギ", p: 500 },
    { n: "ラフテー", p: 600 },
    { n: "ナーベラ", p: 600 },
    { n: "島豆腐", p: 500 }
  ],

  "ご飯": [
    { n: "がじゅ丼", p: 800 },
    { n: "らふて〜丼", p: 800 },
    { n: "焼き飯（らふて〜）", p: 800 },
    { n: "焼き飯（らっきょ）", p: 800 },
    { n: "ちゃんぽん", p: 800 }
  ],

  "そば": [
    { n: "ソーキそば", p: 800 },
    { n: "テビチそば", p: 1000 }
  ],

  "リゾット": [
    { n: "チーズリゾット", p: 900 },
    { n: "イカ墨リゾット", p: 900 },
    { n: "チーズトマトリゾット", p: 1000 }
  ],

  "ビール": [
    { n: "生ビール", p: 700, t: "drink" },
    { n: "瓶ビール", p: 700, t: "drink" }
  ],

  "ハイボール": [
    { n: "角ハイボール", p: 600, t: "alcohol" }
  ],

  "サワー": [
    { n: "レモンサワー", p: 600, t: "alcohol" },
    { n: "シークヮーサーサワー", p: 600, t: "alcohol" },
    { n: "ガリサワー", p: 600, t: "alcohol" },
    { n: "クエン酸サワー", p: 600, t: "alcohol" },
    { n: "男梅サワー", p: 600, t: "alcohol" }
  ],

  "茶割り": [
    { n: "ウーロンハイ", p: 600, t: "alcohol" },
    { n: "緑茶ハイ", p: 600, t: "alcohol" },
    { n: "さんぴん茶ハイ", p: 600, t: "alcohol" },
    { n: "無糖紅茶ハイ", p: 600, t: "alcohol" },
    { n: "ヒゲ茶ハイ", p: 600, t: "alcohol" }
  ],

  "焼酎": [
    { n: "黒霧島", p: 600, t: "alcohol" },
    { n: "二階堂", p: 600, t: "alcohol" },
    { n: "金宮", p: 600, t: "alcohol" },
    { n: "ダイヤメ（600円）", p: 600, t: "alcohol" }
  ],

  "泡盛（本島）": [
    { n: "菊之露", p: 600, t: "alcohol" },
    { n: "残波白", p: 600, t: "alcohol" },
    { n: "残波黒", p: 600, t: "alcohol" }
  ],

  "泡盛（八重山）": [
    { n: "請福", p: 600, t: "alcohol" },
    { n: "八重泉", p: 600, t: "alcohol" },
    { n: "玉の露", p: 600, t: "alcohol" },
    { n: "おもと", p: 600, t: "alcohol" },
    { n: "黒真珠", p: 850, t: "alcohol" }
  ],

  "石垣のお酒": [
    { n: "IMUGE 25°", p: 600, t: "alcohol" },
    { n: "IMUGE 37°", p: 600, t: "alcohol" },
    { n: "島ラム", p: 700, t: "rum" }
  ],

  "リキュール": [
    { n: "せいふく（ゆず）", p: 600, t: "alcohol" },
    { n: "せいふく（生姜レモン）", p: 600, t: "alcohol" },
    { n: "せいふく（シークヮーサー）", p: 600, t: "alcohol" },
    { n: "せいふく（パッションフルーツ）", p: 600, t: "alcohol" }
  ]
};


/* ===============================
   UI生成（カテゴリ一覧）
=============================== */
const categoryList = document.getElementById("categoryList");
const menuList = document.getElementById("menuList");

categories.forEach(cat => {
  const div = document.createElement("div");
  div.className = "category-item";
  div.textContent = cat;
  div.dataset.cat = cat;

  div.onclick = () => showCategory(cat);
  categoryList.appendChild(div);
});


/* ===============================
   メニュー表示
=============================== */
function showCategory(cat) {
  document.querySelectorAll(".category-item").forEach(c =>
    c.classList.remove("active")
  );
  document.querySelector(`.category-item[data-cat="${cat}"]`).classList.add("active");

  menuList.innerHTML = "";

  menuData[cat].forEach(item => {
    const div = document.createElement("div");
    div.className = "menu-item";
    div.onclick = () => openModal(item);

    div.innerHTML = `
      <span class="menu-title">${item.n}</span>
      <span class="menu-price">¥${item.p}</span>
    `;

    menuList.appendChild(div);
  });
}


/* ===============================
   モーダル
=============================== */
const modal = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalPrice = document.getElementById("modalPrice");
const qtyNumber = document.getElementById("qtyNumber");
const memoInput = document.getElementById("memoInput");

let currentItem = null;

function openModal(item) {
  currentItem = item;
  modalTitle.textContent = item.n;
  modalPrice.textContent = `¥${item.p}`;
  qtyNumber.textContent = 1;
  memoInput.value = "";

  const optBox = document.getElementById("modalOptions");
  optBox.innerHTML = "";

  let opts = [];

  if (item.t === "rum") {
    opts = ["ソーダ", "ロック", "ストレート"];
  } else if (item.t === "alcohol") {
    opts = ["水割り", "ソーダ割り", "ロック", "ストレート"];
  }

  opts.forEach(op => {
    const b = document.createElement("div");
    b.className = "option-btn";
    b.textContent = op;

    b.onclick = () => {
      document.querySelectorAll(".option-btn").forEach(x =>
        x.classList.remove("active")
      );
      b.classList.add("active");
    };

    optBox.appendChild(b);
  });

  modal.style.display = "flex";
}

document.getElementById("closeModalBtn").onclick = () => {
  modal.style.display = "none";
};


/* ===============================
   数量変更
=============================== */
document.getElementById("qtyPlus").onclick = () => {
  qtyNumber.textContent = Number(qtyNumber.textContent) + 1;
};

document.getElementById("qtyMinus").onclick = () => {
  qtyNumber.textContent = Math.max(1, Number(qtyNumber.textContent) - 1);
};


/* ===============================
   カート
=============================== */
let cart = [];
const cartItemsBox = document.getElementById("cartItems");
const cartTotalBox = document.getElementById("cartTotal");

document.getElementById("addCartBtn").onclick = () => {
  const qty = Number(qtyNumber.textContent);

  let option = "";
  const active = document.querySelector(".option-btn.active");
  if (active) option = active.textContent;

  const memo = memoInput.value;

  cart.push({
    name: currentItem.n,
    price: currentItem.p,
    qty,
    option,
    memo,
    type: currentItem.t ? "drink" : "food"
  });

  updateCart();
  modal.style.display = "none";
};


/* ===============================
   カート更新
=============================== */
function updateCart() {
  cartItemsBox.innerHTML = "";
  let total = 0;

  cart.forEach(it => {
    total += it.price * it.qty;

    const row = document.createElement("div");
    row.className = "cart-row";

    row.innerHTML = `
      ${it.name} ×${it.qty}
      ${it.option ? "（" + it.option + "）" : ""}
      ${it.memo ? "【" + it.memo + "】" : ""}
    `;

    cartItemsBox.appendChild(row);
  });

  cartTotalBox.textContent = `合計: ¥${total}`;
}


/* ===============================
   LINE送信
=============================== */
document.getElementById("sendBtn").onclick = async () => {
  const seat = document.getElementById("seatSelect").value;

  if (!seat) {
    alert("席を選択してください");
    return;
  }

  if (cart.length === 0) {
    alert("カートが空です");
    return;
  }

  const food = [];
  const drink = [];

  cart.forEach(it => {
    let line = `${it.name} ×${it.qty}`;
    if (it.option) line += `（${it.option}）`;
    if (it.memo) line += `【${it.memo}】`;

    if (it.type === "drink") drink.push(line);
    else food.push(line);
  });

  const total = cart.reduce((a, b) => a + b.price * b.qty, 0);

  const payload = { seat, food, drink, total };

  try {
    await fetch("https://odd-shape-3114.ashibinaa-izakaya.workers.dev/order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    alert("注文を送信しました！");
    cart = [];
    updateCart();
  } catch (err) {
    alert("送信エラー：" + err);
  }
};


/* ===============================
   初期表示（最初のカテゴリ）
=============================== */
showCategory("オススメ");
