<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>店内注文 - あしびなぁ（UI仮組み）</title>

<style>
body {
  margin: 0;
  background: #0b0c10;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic";
  display: flex;
  height: 100vh;
  overflow: hidden;
}

/* 左カテゴリ */
#categoryList {
  width: 28%;
  background: #111;
  overflow-y: auto;
  border-right: 1px solid #333;
}
.category-item {
  padding: 14px;
  border-bottom: 1px solid #222;
  cursor: pointer;
}
.category-item.active {
  background: #1d3c50;
}

/* 中央メニュー表示部 */
#menuList {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
}
.menu-item {
  padding: 12px;
  background: #1a1c22;
  border: 1px solid #333;
  border-radius: 6px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.menu-item-name { font-size: 1rem; }
.menu-item-price { font-size: 0.9rem; opacity: 0.8; }

/* 数量表示右側 */
.qty-box {
  display: flex;
  align-items: center;
  gap: 6px;
}
.qty-btn {
  width: 32px;
  height: 32px;
  background: #0f4c75;
  border: none;
  color: #fff;
  border-radius: 4px;
  font-size: 1.1rem;
}

/* 下部カート */
#cartBar {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: #000;
  border-top: 1px solid #333;
  padding: 12px;
  display: flex;
  justify-content: space-between;
  font-size: 1rem;
}
#sendBtn {
  background: #06c755;
  padding: 10px 18px;
  border-radius: 6px;
  cursor: pointer;
}

/* 商品タップ → 詳細モーダル */
#detailModal {
  position: fixed;
  bottom: -100%;
  left: 0;
  width: 100%;
  background: #1a1c22;
  border-top: 2px solid #444;
  padding: 20px;
  transition: 0.3s;
}
.modal-title {
  font-size: 1.2rem;
  margin-bottom: 8px;
}
.radiobox {
  margin: 4px 0;
}
textarea {
  width: 100%;
  height: 60px;
  background: #0f0f0f;
  color: #fff;
  border: 1px solid #444;
  border-radius: 6px;
  margin-top: 8px;
  padding: 6px;
}
#addBtn {
  margin-top: 10px;
  width: 100%;
  background: #0f4c75;
  padding: 10px;
  border-radius: 6px;
  text-align: center;
  cursor: pointer;
}

</style>
</head>
<body>

<!-- 左カテゴリ -->
<div id="categoryList"></div>

<!-- 中央メニュー -->
<div id="menuList"></div>

<!-- カート -->
<div id="cartBar">
  <div id="cartInfo">0点 | 合計 ¥0</div>
  <div id="sendBtn">注文送信</div>
</div>

<!-- 詳細モーダル -->
<div id="detailModal">
  <div class="modal-title" id="modalName"></div>
  <div id="modalPrice"></div>

  <div id="modalOptions"></div>

  <textarea id="memoInput" placeholder="メモ（氷少なめ、薄め等）"></textarea>
  <div id="addBtn">追加する</div>
</div>

<script>
/* ===== API（LINE送信用） ===== */
const API_ENDPOINT = "https://odd-shape-3114.ashibinaa-izakaya.workers.dev/order";

/* ===== 仮メニュー（後で本番全メニューに差し替え可） ===== */
const DATA = {
  "おすすめ": [
    { name: "石垣牛ハンバーグ", price: 1600, type: "food" }
  ],
  "おつまみ": [
    { name: "島らっきょ", price: 500, type: "food" }
  ],
  "チャンプル": [
    { name: "ゴーヤチャンプル", price: 800, type: "food" }
  ],
  "焼酎": [
    { name: "黒霧島", price: 550, type: "drink", subtype: "shochu" }
  ],
  "石垣島のお酒": [
    { name: "島ラム", price: 700, type: "drink", subtype: "rum" }
  ],
  "ショット": [
    { name: "ハブーラ", price: 1400, type: "drink", subtype: "shot" }
  ]
};

/* ===== UI構築 ===== */
const categoryList = document.getElementById("categoryList");
const menuList = document.getElementById("menuList");

Object.keys(DATA).forEach((cat, i) => {
  const div = document.createElement("div");
  div.className = "category-item" + (i === 0 ? " active" : "");
  div.textContent = cat;
  div.onclick = () => {
    document.querySelectorAll(".category-item").forEach(e => e.classList.remove("active"));
    div.classList.add("active");
    renderMenu(cat);
  };
  categoryList.appendChild(div);
});

/* ===== メニュー描画 ===== */
function renderMenu(category) {
  menuList.innerHTML = "";
  DATA[category].forEach(item => {
    const div = document.createElement("div");
    div.className = "menu-item";

    div.innerHTML = `
      <div>
        <div class="menu-item-name">${item.name}</div>
        <div class="menu-item-price">¥${item.price}</div>
      </div>
      <div class="qty-box">
        <button class="qty-btn" onclick="changeQty('${item.name}', -1)">−</button>
        <div id="qty-${item.name}">0</div>
        <button class="qty-btn" onclick="openDetail('${item.name}', ${item.price}, '${item.type}', '${item.subtype || ""}')">＋</button>
      </div>
    `;
    menuList.appendChild(div);
  });
}

/* 初期表示 */
renderMenu(Object.keys(DATA)[0]);

/* ===== カート処理 ===== */
let cart = [];

function changeQty(name, num) {
  const entry = cart.find(x => x.name === name);
  if (entry) {
    entry.qty += num;
    if (entry.qty <= 0) cart = cart.filter(x => x.name !== name);
  }
  updateCartUI();
}

function updateCartUI() {
  let totalQty = 0, totalPrice = 0;

  cart.forEach(e => {
    totalQty += e.qty;
    totalPrice += e.qty * e.price;
    document.getElementById(`qty-${e.name}`).textContent = e.qty;
  });

  document.getElementById("cartInfo").textContent = `${totalQty}点 | 合計 ¥${totalPrice}`;
}

/* ===== 詳細モーダル ===== */
const modal = document.getElementById("detailModal");
let currentItem = {};

function openDetail(name, price, type, subtype) {
  currentItem = { name, price, type, subtype };

  document.getElementById("modalName").textContent = name;
  document.getElementById("modalPrice").textContent = `¥${price}`;

  let html = "";

  if (subtype === "shochu" || subtype === "awamori" || subtype === "whisky") {
    html += radioGroup(["水割り", "ロック", "ストレート", "ソーダ"]);
  } else if (subtype === "rum") {
    html += radioGroup(["ロック", "ストレート", "ソーダ"]);
  } else if (subtype === "shot") {
    html += `<div>ショット（割り方なし）</div>`;
  } else {
    html += `<div>料理（メモのみ）</div>`;
  }

  document.getElementById("modalOptions").innerHTML = html;

  modal.style.bottom = "0";
}

function radioGroup(list) {
  return list.map(v => `
    <label class="radiobox">
      <input type="radio" name="option" value="${v}"> ${v}
    </label>
  `).join("");
}

document.getElementById("addBtn").onclick = () => {
  const option = document.querySelector('input[name="option"]:checked');
  const memo = document.getElementById("memoInput").value;

  cart.push({
    name: currentItem.name + (option ? `（${option.value}）` : ""),
    price: currentItem.price,
    qty: 1,
    memo
  });

  modal.style.bottom = "-100%";
  document.getElementById("memoInput").value = "";
  updateCartUI();
};

/* ===== 注文送信 ===== */
document.getElementById("sendBtn").onclick = async () => {
  if (cart.length === 0) return alert("注文がありません");

  const payload = { order: cart };

  await fetch(API_ENDPOINT, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
  });

  alert("注文を送信しました！");
  cart = [];
  updateCartUI();
};
</script>
</body>
</html>
