<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>åº—å†…æ³¨æ–‡ - ã‚ã—ã³ãªã</title>

<style>
/* ============================
   ç”»é¢å…¨ä½“
============================ */
body {
  margin: 0;
  background: #0b0c10;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic";
  height: 100vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* ============================
   ä¸Šï¼šå¸­é¸æŠ
============================ */
#seatSelectBox {
  padding: 12px;
  background: #101820;
  border-bottom: 1px solid #333;
}

#seatSelect {
  padding: 8px;
  border-radius: 6px;
  border: none;
  background: #182733;
  color: #fff;
}

/* ============================
   ãƒ¡ã‚¤ãƒ³3åˆ†å‰²
============================ */
#container {
  flex: 1;
  display: flex;
  height: calc(100vh - 120px);
}

/* å·¦ï¼šã‚«ãƒ†ã‚´ãƒª */
#categoryList {
  width: 28%;
  background: #111c27;
  overflow-y: auto;
  border-right: 1px solid #333;
  padding: 10px;
}

.category-item {
  padding: 14px 10px;
  margin-bottom: 8px;
  background: #15293b;
  color: #cde6ff;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
}

.category-item.active {
  background: #1f3f5e;
  color: #fff;
  border-left: 4px solid #4db8ff;
}

/* ä¸­å¤®ï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
#menuList {
  width: 44%;
  padding: 10px;
  overflow-y: auto;
}

.menu-item {
  background: #1a1a1a;
  border: 1px solid #333;
  margin-bottom: 10px;
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
}

.menu-item:hover {
  background: #2a2a2a;
}

.menu-title {
  font-size: 1rem;
  font-weight: bold;
}

.menu-price {
  float: right;
  color: #f5d36b;
}

/* å³ï¼šã‚«ãƒ¼ãƒˆ */
#cartPanel {
  width: 28%;
  background: #111c27;
  border-left: 1px solid #333;
  padding: 12px;
  display: flex;
  flex-direction: column;
}

#cartInfo {
  margin-top: auto;
  padding: 12px 0;
  font-size: 1.1rem;
  text-align: center;
}

#sendBtn {
  background: #06c755;
  padding: 12px;
  border-radius: 8px;
  color: #fff;
  font-weight: 600;
  text-align: center;
  font-size: 1.1rem;
  cursor: pointer;
}

/* ============================
   ãƒ¢ãƒ¼ãƒ€ãƒ«
============================ */
#detailModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal-box {
  background: #16222e;
  padding: 20px;
  width: 90%;
  max-width: 380px;
  border-radius: 10px;
}

.modal-title {
  font-size: 1.3rem;
  margin-bottom: 6px;
}

.modal-price {
  font-size: 1.1rem;
  color: #f5d36b;
  margin-bottom: 14px;
}

.qty-box {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 12px 0;
}

.qty-btn {
  background: #254057;
  border-radius: 6px;
  padding: 10px 20px;
  font-size: 1.4rem;
  cursor: pointer;
}

.qty-display {
  width: 40px;
  text-align: center;
  font-size: 1.4rem;
}

.option-btn {
  display: inline-block;
  padding: 8px 12px;
  background: #254057;
  margin: 4px;
  border-radius: 6px;
  cursor: pointer;
}

.option-btn.active {
  background: #4db8ff;
}

.memo-input {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  background: #0f1b27;
  border: none;
  margin-top: 10px;
  color: #fff;
}

.modal-btn {
  margin-top: 12px;
  padding: 12px;
  background: #06c755;
  border-radius: 8px;
  text-align: center;
  color: #fff;
  cursor: pointer;
}
</style>
</head>
<body>

<!-- ===============================
     å¸­é¸æŠ
=============================== -->
<div id="seatSelectBox">
  <label>å¸­ç•ªå·ï¼š</label>
  <select id="seatSelect">
    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    <option value="A1">A1</option>
    <option value="A2">A2</option>
    <option value="A3">A3</option>
    <option value="B1">B1</option>
    <option value="B2">B2</option>
    <option value="B3">B3</option>
  </select>
</div>

<!-- ===============================
     ãƒ¡ã‚¤ãƒ³ç”»é¢ 3ã‚«ãƒ©ãƒ 
=============================== -->
<div id="container">

  <!-- å·¦ï¼šã‚«ãƒ†ã‚´ãƒª -->
  <div id="categoryList"></div>

  <!-- ä¸­å¤®ï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ -->
  <div id="menuList"></div>

  <!-- å³ï¼šã‚«ãƒ¼ãƒˆãƒ‘ãƒãƒ« -->
  <div id="cartPanel">
    <div id="cartItems"></div>
    <div id="cartInfo">0 ç‚¹ ï½œ Â¥0</div>
    <div id="sendBtn" onclick="sendOrder()">æ³¨æ–‡é€ä¿¡</div>
  </div>

</div>

<!-- ===============================
     è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ•°é‡ãƒ»å‰²ã‚Šæ–¹ãƒ»ãƒ¡ãƒ¢ï¼‰
=============================== -->
<div id="detailModal">
  <div class="modal-box">

    <div id="modalName" class="modal-title"></div>
    <div id="modalPrice" class="modal-price"></div>

    <!-- æ•°é‡ -->
    <div class="qty-box">
      <div class="qty-btn" onclick="changeQty(-1)">ï¼</div>
      <div id="modalQty" class="qty-display">1</div>
      <div class="qty-btn" onclick="changeQty(1)">ï¼‹</div>
    </div>

    <!-- å‰²ã‚Šæ–¹ -->
    <div id="modalOptions"></div>

    <!-- ãƒ¡ãƒ¢ -->
    <textarea id="memoInput" class="memo-input"
      placeholder="ãƒ¡ãƒ¢ï¼ˆæ°·å°‘ãªã‚ã€è–„ã‚ ç­‰ï¼‰"></textarea>

    <!-- è¿½åŠ ãƒœã‚¿ãƒ³ -->
    <div class="modal-btn" onclick="addToCart()">è¿½åŠ ã™ã‚‹</div>
    <div class="modal-btn" style="background:#444" onclick="closeModal()">é–‰ã˜ã‚‹</div>
  </div>
</div>

<script>
/* ============================================================
   ãƒ¡ãƒ‹ãƒ¥ãƒ¼å®šç¾©
============================================================ */

const categories = [
  { id: "osusume", name: "â­ ã‚ªã‚¹ã‚¹ãƒ¡" },
  { id: "food", name: "ğŸ½ ãƒ•ãƒ¼ãƒ‰" },
  { id: "drink", name: "ğŸ» ãƒ‰ãƒªãƒ³ã‚¯" },
  { id: "awamori_hontou", name: "ğŸ¥ƒ æ³¡ç››ï¼ˆæ²–ç¸„æœ¬å³¶ï¼‰" },
  { id: "awamori_yaeyama", name: "ğŸ¥ƒ æ³¡ç››ï¼ˆå…«é‡å±±ï¼‰" },
  { id: "ishigaki", name: "ğŸ¥ƒ çŸ³å£å³¶ã®ãŠé…’" }
];

/* ======================
   å•†å“ãƒªã‚¹ãƒˆ
====================== */

const menuData = {

  /* --- ã‚ªã‚¹ã‚¹ãƒ¡ --- */
  osusume: [
    { name: "çŸ³å£ç‰›ãƒãƒ³ãƒãƒ¼ã‚°", price: 1600 },
    { name: "ã–ã‚‹ã‚‚ãšã", price: 800 },
    { name: "ã‚‚ãšãã‚­ãƒ ãƒ", price: 650 }
  ],

  /* --- ãƒ•ãƒ¼ãƒ‰ --- */
  food: [
    { name: "ã‚´ãƒ¼ãƒ¤ãƒãƒ£ãƒ³ãƒ—ãƒ«", price: 800 },
    { name: "ãƒ’ãƒ©ãƒ¤ãƒ¼ãƒ", price: 650 },
    { name: "ãƒãƒã‚®", price: 650 },
    { name: "å³¶ç„¼ããã°ï¼ˆå¡©ï¼‰", price: 900 },
    { name: "å³¶ç„¼ããã°ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¯ã‚µãƒ¼ï¼‰", price: 950 },
    { name: "ã‚¢ã‚°ãƒ¼ãƒšãƒšãƒ­ãƒ³", price: 1200 },
    { name: "ãƒ”ãƒªè¾›ã‚¨ãƒ“ãƒˆãƒãƒˆ", price: 1300 },
    { name: "æœ¬æ—¥ã®æ°—ã¾ãã‚Œ", price: 1200 },
    { name: "å³¶ã‚‰ã£ãã‚‡", price: 500 },
    { name: "å³¶ã‚‰ã£ãã‚‡ã‚¯ãƒªãƒ¼ãƒ ãƒãƒ¼ã‚ºãƒ™ãƒ¼ã‚³ãƒ³", price: 750 },
    { name: "ãƒ©ãƒ•ãƒ†ãƒ¼", price: 850 }
  ],

  /* --- ãƒ‰ãƒªãƒ³ã‚¯ï¼ˆä¸€èˆ¬ï¼‰ --- */
  drink: [
    { name: "ç”Ÿãƒ“ãƒ¼ãƒ«", price: 700 },
    { name: "ç“¶ãƒ“ãƒ¼ãƒ«", price: 700 },
    { name: "ãƒã‚¤ãƒœãƒ¼ãƒ«ï¼ˆè§’ï¼‰", price: 650, drinkType: "alcohol" },
    { name: "ã‚¸ãƒ³ãƒˆãƒ‹ãƒƒã‚¯", price: 650, drinkType: "alcohol" },
    { name: "ãƒ¬ãƒ¢ãƒ³ã‚µãƒ¯ãƒ¼", price: 600, drinkType: "alcohol" },
    { name: "ç·‘èŒ¶ãƒã‚¤", price: 600, drinkType: "alcohol" },
    { name: "çƒé¾ãƒã‚¤", price: 600, drinkType: "alcohol" },
    { name: "ã•ã‚“ã´ã‚“ãƒã‚¤", price: 600, drinkType: "alcohol" },
    { name: "é»’éœ§å³¶", price: 550, drinkType: "alcohol" },
    { name: "é‡‘å®®", price: 550, drinkType: "alcohol" },
    { name: "ãƒ€ã‚¤ãƒ¤ãƒ¡", price: 600, drinkType: "alcohol" }
  ],

  /* --- æ³¡ç››ï¼ˆæ²–ç¸„æœ¬å³¶ï¼‰ --- */
  awamori_hontou: [
    { name: "èŠä¹‹éœ²", price: 650, drinkType: "alcohol" },
    { name: "æ®‹æ³¢ ç™½", price: 650, drinkType: "alcohol" },
    { name: "æ®‹æ³¢ é»’", price: 650, drinkType: "alcohol" }
  ],

  /* --- æ³¡ç››ï¼ˆå…«é‡å±±ï¼‰ --- */
  awamori_yaeyama: [
    { name: "è«‹ç¦", price: 650, drinkType: "alcohol" },
    { name: "å…«é‡æ³‰", price: 650, drinkType: "alcohol" },
    { name: "é»’çœŸç ", price: 850, drinkType: "alcohol" }
  ],

  /* --- çŸ³å£å³¶ã®ãŠé…’ --- */
  ishigaki: [
    { name: "IMUGE 25Â°", price: 700, drinkType: "alcohol" },
    { name: "IMUGE 37Â°", price: 900, drinkType: "alcohol" },
    { name: "å³¶ãƒ©ãƒ ï¼ˆISLAND RUMï¼‰", price: 700, drinkType: "rum" },
    { name: "è«‹ç¦ã‚·ãƒ¼ã‚¯ãƒ¯ã‚µãƒ¼", price: 650, drinkType: "alcohol" },
    { name: "è«‹ç¦ãƒ¬ãƒ¢ãƒ³", price: 650, drinkType: "alcohol" },
    { name: "è«‹ç¦ãƒ‘ãƒƒã‚·ãƒ§ãƒ³ãƒ•ãƒ«ãƒ¼ãƒ„", price: 650, drinkType: "alcohol" }
  ]
};


/* ============================================================
   DOMã«ã‚«ãƒ†ã‚´ãƒªãƒ»ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
============================================================ */

function renderCategories() {
  const box = document.getElementById("categoryList");
  box.innerHTML = "";

  categories.forEach(cat => {
    const div = document.createElement("div");
    div.className = "category-item";
    div.dataset.cat = cat.id;
    div.textContent = cat.name;

    div.onclick = () => showCategory(cat.id);

    box.appendChild(div);
  });
}

function renderMenus() {
  const menuList = document.getElementById("menuList");
  menuList.innerHTML = "";

  categories.forEach(cat => {
    const group = document.createElement("div");
    group.className = "menu-group";
    group.dataset.cat = cat.id;

    menuData[cat.id].forEach(item => {

      const card = document.createElement("div");
      card.className = "menu-item";
      card.onclick = () => openModal(item);

      const title = document.createElement("div");
      title.className = "menu-title";
      title.textContent = item.name;

      const price = document.createElement("div");
      price.className = "menu-price";
      price.textContent = "Â¥" + item.price;

      card.appendChild(title);
      card.appendChild(price);
      group.appendChild(card);
    });

    menuList.appendChild(group);
  });
}


/* ============================================================
   ã‚«ãƒ†ã‚´ãƒªåˆ‡ã‚Šæ›¿ãˆ
============================================================ */

function showCategory(catId) {
  document.querySelectorAll(".category-item").forEach(c => {
    c.classList.toggle("active", c.dataset.cat === catId);
  });

  document.querySelectorAll(".menu-group").forEach(group => {
    group.style.display = (group.dataset.cat === catId) ? "block" : "none";
  });
}


/* ============================================================
   ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆå‰²ã‚Šæ–¹ãƒ»æ•°é‡ï¼‰
============================================================ */

let selectedItem = null;

function openModal(item) {
  selectedItem = item;

  document.getElementById("modalName").textContent = item.name;
  document.getElementById("modalPrice").textContent = "Â¥" + item.price;
  document.getElementById("modalQty").textContent = 1;
  document.getElementById("memoInput").value = "";

  const optBox = document.getElementById("modalOptions");
  optBox.innerHTML = "";

  let options = [];

  if (item.drinkType === "rum") {
    options = ["ã‚½ãƒ¼ãƒ€", "ãƒ­ãƒƒã‚¯", "ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ"];
  } else if (item.drinkType === "alcohol") {
    options = ["æ°´å‰²ã‚Š", "ã‚½ãƒ¼ãƒ€å‰²ã‚Š", "ãƒ­ãƒƒã‚¯", "ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ"];
  }

  options.forEach(opt => {
    const b = document.createElement("div");
    b.className = "option-btn";
    b.textContent = opt;

    b.onclick = () => {
      document.querySelectorAll(".option-btn").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
    };

    optBox.appendChild(b);
  });

  document.getElementById("detailModal").style.display = "flex";
}

function changeQty(v) {
  const label = document.getElementById("modalQty");
  let q = parseInt(label.textContent);
  q = Math.max(1, q + v);
  label.textContent = q;
}

function closeModal() {
  document.getElementById("detailModal").style.display = "none";
}


/* ============================================================
   ã‚«ãƒ¼ãƒˆå‡¦ç†
============================================================ */

let cart = [];

function addToCart() {
  const qty = parseInt(document.getElementById("modalQty").textContent);
  const memo = document.getElementById("memoInput").value;

  let option = "";
  const activeOpt = document.querySelector(".option-btn.active");
  if (activeOpt) option = activeOpt.textContent;

  cart.push({
    name: selectedItem.name,
    price: selectedItem.price,
    qty,
    option,
    memo
  });

  updateCart();
  closeModal();
}

function updateCart() {
  const cartPanel = document.getElementById("cartItems");
  cartPanel.innerHTML = "";

  let totalQty = 0;
  let totalPrice = 0;

  cart.forEach(item => {
    totalQty += item.qty;
    totalPrice += item.price * item.qty;

    const row = document.createElement("div");
    row.textContent =
      `${item.name} Ã—${item.qty}` +
      (item.option ? `ï¼ˆ${item.option}ï¼‰` : "") +
      (item.memo ? `ã€${item.memo}ã€‘` : "");

    row.style.marginBottom = "8px";

    cartPanel.appendChild(row);
  });

  document.getElementById("cartInfo").textContent =
    `${totalQty} ç‚¹ ï½œ Â¥${totalPrice}`;
}


/* ============================================================
   LINEã¸æ³¨æ–‡é€ä¿¡
============================================================ */

async function sendOrder() {
  const seat = document.getElementById("seatSelect").value;

  if (!seat) {
    alert("å¸­ã‚’é¸æŠã—ã¦ãã ã•ã„");
    return;
  }

  if (cart.length === 0) {
    alert("ã‚«ãƒ¼ãƒˆãŒç©ºã§ã™");
    return;
  }

  let food = [];
  let drink = [];

  cart.forEach(item => {
    const line =
      `${item.name} Ã—${item.qty}` +
      (item.option ? `ï¼ˆ${item.option}ï¼‰` : "") +
      (item.memo ? `ã€${item.memo}ã€‘` : "");

    if (item.option || item.price >= 500) {
      drink.push(line);
    } else {
      food.push(line);
    }
  });

  const total = cart.reduce((s, i) => s + i.price * i.qty, 0);

  const payload = {
    seat,
    food,
    drink,
    total
  };

  console.log("SEND:", payload);

  await fetch("https://odd-shape-3114.ashibinaa-izakaya.workers.dev/order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  alert("æ³¨æ–‡ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼");
  cart = [];
  updateCart();
}


/* ============================================================
   åˆæœŸåŒ–
============================================================ */

renderCategories();
renderMenus();
showCategory("osusume");

</script>

</body>
</html>
