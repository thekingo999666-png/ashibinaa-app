<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>åº—å†…æ³¨æ–‡ - ã‚ã—ã³ãªã</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #111;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Sans", "Yu Gothic", sans-serif;
}

/* ---------- ãƒ˜ãƒƒãƒ€ãƒ¼ ---------- */
header {
  background: #222;
  padding: 16px;
  text-align: center;
  font-size: 1.4rem;
  font-weight: bold;
  position: relative;
  border-bottom: 3px solid #f5a623;
}

/* è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ */
#langToggle {
  position: absolute;
  top: 12px;
  right: 16px;
  background: #f5a623;
  color: #111;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

/* ---------- ã‚«ãƒ†ã‚´ãƒª ---------- */
.category-title {
  background: #333;
  padding: 12px;
  font-size: 1.1rem;
  font-weight: bold;
  border-left: 4px solid #f5a623;
  cursor: pointer;
}
.category-content {
  display: none;
  background: #222;
  padding: 10px;
}

/* ---------- ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›® ---------- */
.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  border-bottom: 1px solid #444;
  cursor: pointer;
}
.item-name {
  font-size: 1rem;
}
.qty {
  background: #f5a623;
  color: #111;
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: bold;
  min-width: 30px;
  text-align: center;
}

/* ---------- å±¥æ­´ ---------- */
#historyBox {
  background: #222;
  margin: 14px;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #555;
}

/* ---------- PINãƒ¢ãƒ¼ãƒ€ãƒ« ---------- */
#pinModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  justify-content: center;
  align-items: center;
  z-index: 9000;
}
#pinBox {
  background: #fff;
  color: #111;
  padding: 20px;
  width: 80%;
  max-width: 320px;
  border-radius: 12px;
  text-align: center;
}
#pinInput {
  width: 70%;
  padding: 10px;
  font-size: 1.1rem;
  margin-top: 12px;
  text-align: center;
}

/* ---------- å¸­é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« ---------- */
#seatModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  justify-content: center;
  align-items: center;
  z-index: 8000;
}
#seatBox {
  background: #fff;
  color: #111;
  padding: 20px;
  width: 80%;
  max-width: 350px;
  border-radius: 12px;
  text-align: center;
}
.seat-btn {
  width: 100%;
  padding: 12px;
  margin: 6px 0;
  border: none;
  border-radius: 6px;
  background: #f5a623;
  color: #111;
  font-size: 1rem;
  cursor: pointer;
}

/* ---------- è¦æœ›æ¬„ ---------- */
#memoBox {
  width: 90%;
  margin: 20px auto;
  display: block;
  background: #222;
  color: #fff;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #666;
}

/* ---------- æ³¨æ–‡ãƒªã‚¹ãƒˆ ---------- */
#orderListBox {
  background: #000;
  padding: 14px;
  margin-top: 20px;
  border-top: 2px solid #f5a623;
}
.order-row {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid #333;
}
.del-btn {
  background: #f33;
  color: #fff;
  border: none;
  padding: 4px 8px;
  border-radius: 6px;
  cursor: pointer;
}

/* ---------- æ³¨æ–‡ãƒœã‚¿ãƒ³ ---------- */
.order-button {
  display: block;
  width: 90%;
  margin: 20px auto;
  padding: 14px;
  font-size: 1.2rem;
  background: #f5a623;
  color: #111;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}
</style>
</head>

<body>

<header>
  åº—å†…æ³¨æ–‡
  <button id="langToggle">EN</button>
</header>

<!-- PINç®¡ç† -->
<div id="pinModal">
  <div id="pinBox">
    <h2>PINå…¥åŠ›</h2>
    <input type="password" id="pinInput" placeholder="PIN" />
    <button onclick="checkPin()">OK</button>
  </div>
</div>

<!-- å±¥æ­´ -->
<div id="historyBox">
  <h3>æ³¨æ–‡å±¥æ­´</h3>
  <div id="historyList"></div>
  <button id="clearHistoryBtn" style="display:none;" onclick="clearHistory()">å±¥æ­´ã‚¯ãƒªã‚¢</button>
</div>

<!-- å¸­é¸æŠ -->
<select id="seatSelect" style="display:none;">
  <option value="">æœªé¸æŠ</option>
  <option value="ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼1">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼1</option>
  <option value="ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼2">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼2</option>
  <option value="ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼3">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼3</option>
  <option value="ãƒ†ãƒ¼ãƒ–ãƒ«1">ãƒ†ãƒ¼ãƒ–ãƒ«1</option>
  <option value="ãƒ†ãƒ¼ãƒ–ãƒ«2">ãƒ†ãƒ¼ãƒ–ãƒ«2</option>
  <option value="ã‚¹ã‚¿ãƒ³ãƒ‰1">ã‚¹ã‚¿ãƒ³ãƒ‰1</option>
  <option value="ã‚¹ã‚¿ãƒ³ãƒ‰2">ã‚¹ã‚¿ãƒ³ãƒ‰2</option>
  <option value="åº§æ•·">åº§æ•·</option>
</select>

<div id="seatModal">
  <div id="seatBox">
    <h2>å¸­ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
    <button class="seat-btn" onclick="selectSeat('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼1')">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼1</button>
    <button class="seat-btn" onclick="selectSeat('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼2')">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼2</button>
    <button class="seat-btn" onclick="selectSeat('ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼3')">ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼3</button>
    <button class="seat-btn" onclick="selectSeat('ãƒ†ãƒ¼ãƒ–ãƒ«1')">ãƒ†ãƒ¼ãƒ–ãƒ«1</button>
    <button class="seat-btn" onclick="selectSeat('ãƒ†ãƒ¼ãƒ–ãƒ«2')">ãƒ†ãƒ¼ãƒ–ãƒ«2</button>
    <button class="seat-btn" onclick="selectSeat('ã‚¹ã‚¿ãƒ³ãƒ‰1')">ã‚¹ã‚¿ãƒ³ãƒ‰1</button>
    <button class="seat-btn" onclick="selectSeat('ã‚¹ã‚¿ãƒ³ãƒ‰2')">ã‚¹ã‚¿ãƒ³ãƒ‰2</button>
    <button class="seat-btn" onclick="selectSeat('åº§æ•·')">åº§æ•·</button>
  </div>
</div>

<!-- è¦æœ›æ¬„ -->
<textarea id="memoBox" placeholder="è¦æœ›ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„"></textarea>

<!-- æ³¨æ–‡ãƒªã‚¹ãƒˆ -->
<div id="orderListBox">
  <h3>æ³¨æ–‡ãƒªã‚¹ãƒˆ</h3>
  <div id="orderList"></div>
</div>

<!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
<div id="menuArea">

<h2 style="padding-left:12px;">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>

<!-- ã“ã“ã«ã‚«ãƒ†ã‚´ãƒªã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒç¶šãï¼ˆmenuDataã‹ã‚‰è‡ªå‹•ç”Ÿæˆã—ãªã„ä»•æ§˜ï¼‰ -->

<script>
/* ============================
   â–¼ menuData ï¼ˆå…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰
============================ */

const menuData = [
  /* --- ãƒ•ãƒ¼ãƒ‰ --- */
  { jp:"æè±†", en:"Edamame", type:"food", index:1 },
  { jp:"å³¶è±†è…", en:"Okinawa Tofu", type:"food", index:2 },
  { jp:"ã‚‚ãšãé…¢", en:"Mozuku Vinegar", type:"food", index:3 },
  { jp:"æµ·ã¶ã©ã†", en:"Sea Grapes", type:"food", index:4 },
  { jp:"ãƒãƒ†ãƒˆãƒ•ãƒ©ã‚¤", en:"French Fries", type:"food", index:5 },
  { jp:"å”æšã’", en:"Fried Chicken", type:"food", index:6 },
  { jp:"ã ã—å·»ãåµ", en:"Dashimaki Egg", type:"food", index:7 },
  { jp:"ãƒãƒ³ãƒãƒ¼ã‚°", en:"Hamburg Steak", type:"food", index:8 },

  /* --- ãƒ‰ãƒªãƒ³ã‚¯ --- */
  { jp:"ç”Ÿãƒ“ãƒ¼ãƒ«", en:"Draft Beer", type:"drink", index:101 },
  { jp:"ç“¶ãƒ“ãƒ¼ãƒ«", en:"Bottled Beer", type:"drink", index:102 },
  { jp:"ãƒã‚¤ãƒœãƒ¼ãƒ«", en:"Highball", type:"drink", index:103 },
  { jp:"ãƒ¬ãƒ¢ãƒ³ã‚µãƒ¯ãƒ¼", en:"Lemon Sour", type:"drink", index:104 },
  { jp:"ã‚¦ãƒ¼ãƒ­ãƒ³èŒ¶", en:"Oolong Tea", type:"drink", index:105 },
  { jp:"ç·‘èŒ¶", en:"Green Tea", type:"drink", index:106 },
  { jp:"ã‚³ãƒ¼ãƒ©", en:"Coke", type:"drink", index:107 },
  { jp:"ã‚¸ãƒ³ã‚¸ãƒ£ãƒ¼ã‚¨ãƒ¼ãƒ«", en:"Ginger Ale", type:"drink", index:108 }
];
</script>
<!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆã‚«ãƒ†ã‚´ãƒªæ§‹é€ ï¼‰ -->
<div>
  <!-- ãƒ•ãƒ¼ãƒ‰ -->
  <div class="category-title" onclick="toggleCategory(this)">ãƒ•ãƒ¼ãƒ‰</div>
  <div class="category-content">
    ${menuData
      .filter(m => m.type === "food")
      .map(
        m => `
        <div class="item" onclick="addItem('${m.jp}')">
          <span class="item-name" id="name-${m.jp.replace(/[\s\(\)Â°ãƒ»]/g,'')}">${m.jp}</span>
          <span class="qty" id="qty-${m.jp.replace(/[\s\(\)Â°ãƒ»]/g,'')}">0</span>
        </div>
      `
      )
      .join("")}
  </div>

  <!-- ãƒ‰ãƒªãƒ³ã‚¯ -->
  <div class="category-title" onclick="toggleCategory(this)">ãƒ‰ãƒªãƒ³ã‚¯</div>
  <div class="category-content">
    ${menuData
      .filter(m => m.type === "drink")
      .map(
        m => `
        <div class="item" onclick="addItem('${m.jp}')">
          <span class="item-name" id="name-${m.jp.replace(/[\s\(\)Â°ãƒ»]/g,'')}">${m.jp}</span>
          <span class="qty" id="qty-${m.jp.replace(/[\s\(\)Â°ãƒ»]/g,'')}">0</span>
        </div>
      `
      )
      .join("")}
  </div>
</div>

</div><!-- menuArea END -->

<!-- æ³¨æ–‡ãƒœã‚¿ãƒ³ -->
<button class="order-button" onclick="sendOrder()">æ³¨æ–‡ã™ã‚‹</button>

<!-- ============================
      â–¼ ãƒ¡ã‚¤ãƒ³ã®JavaScript
============================ -->
<script>
/* ==========================================
   â–¼ UI è¨€èª
========================================== */
let currentLang = "jp";

/* ==========================================
   â–¼ æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿
========================================== */
let orderList = [];  // { jp, en, type, qty, index }

/* ==========================================
   â–¼ ã‚«ãƒ†ã‚´ãƒªé–‹é–‰
========================================== */
function toggleCategory(el) {
  const content = el.nextElementSibling;
  const key = "cat-" + el.innerText;

  if (content.style.display === "block") {
    content.style.display = "none";
    localStorage.setItem(key, "0");
  } else {
    content.style.display = "block";
    localStorage.setItem(key, "1");
  }
}

/* ==========================================
   â–¼ ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ 
========================================== */
function addItem(nameJP) {
  const menu = menuData.find(m => m.jp === nameJP);
  if (!menu) return;

  let exist = orderList.find(o => o.jp === menu.jp);

  if (exist) {
    exist.qty++;
  } else {
    orderList.push({
      jp: menu.jp,
      en: menu.en,
      type: menu.type,
      qty: 1,
      index: menu.index
    });
  }

  updateQty(menu.jp);
  updateOrderList();
}

/* ==========================================
   â–¼ æ•°é‡è¡¨ç¤º
========================================== */
function updateQty(nameJP) {
  const id = "qty-" + nameJP.replace(/[\s\(\)Â°ãƒ»]/g, "");
  const el = document.getElementById(id);
  const obj = orderList.find(o => o.jp === nameJP);
  if (el) el.textContent = obj ? obj.qty : 0;
}

/* ==========================================
   â–¼ æ³¨æ–‡ãƒªã‚¹ãƒˆæ›´æ–°
========================================== */
function updateOrderList() {
  const box = document.getElementById("orderList");
  box.innerHTML = "";

  orderList.forEach((o, i) => {
    const row = document.createElement("div");
    row.className = "order-row";
    row.innerHTML = `
      <span>${o.jp} Ã—${o.qty}</span>
      <button class="del-btn" onclick="removeItem(${i})">å‰Šé™¤</button>
    `;
    box.appendChild(row);
  });
}

/* ==========================================
   â–¼ å‰Šé™¤ï¼ˆãƒã‚¤ãƒŠã‚¹ï¼‰
========================================== */
function removeItem(i) {
  const item = orderList[i];
  if (!item) return;

  if (item.qty > 1) {
    item.qty--;
  } else {
    orderList.splice(i, 1);
  }

  updateQty(item.jp);
  updateOrderList();
}

/* ==========================================
   â–¼ å¸­ã®æ±ºå®š
========================================== */
function selectSeat(seat) {
  document.getElementById("seatSelect").value = seat;
  document.getElementById("seatModal").style.display = "none";
}

/* ==========================================
   â–¼ æ³¨æ–‡é€ä¿¡ï¼ˆLINE â†’ Workersï¼‰
========================================== */
async function sendOrder() {
  const seat = document.getElementById("seatSelect").value;

  // ğŸ”¥ YESæŒ‡å®š â†’ å¸­æœªé¸æŠãªã‚‰å¼·åˆ¶çš„ã«ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
  if (!seat || seat === "") {
    document.getElementById("seatModal").style.display = "flex";
    return;
  }

  if (orderList.length === 0) {
    alert("æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“");
    return;
  }

  const memo = document.getElementById("memoBox").value.trim();

  let foods = orderList.filter(o => o.type === "food").sort((a,b)=>a.index-b.index);
  let drinks = orderList.filter(o => o.type === "drink").sort((a,b)=>a.index-b.index);

  let text = `å¸­ï¼š${seat}\n\n`;

  // ãƒ•ãƒ¼ãƒ‰
  if (foods.length > 0) {
    text += "ã€ãƒ•ãƒ¼ãƒ‰ã€‘\n";
    foods.forEach(f => text += `${f.jp} Ã— ${f.qty}\n`);
    text += "\n";
  }

  // ãƒ‰ãƒªãƒ³ã‚¯
  if (drinks.length > 0) {
    text += "ã€ãƒ‰ãƒªãƒ³ã‚¯ã€‘\n";
    drinks.forEach(d => text += `${d.jp} Ã— ${d.qty}\n`);
    text += "\n";
  }

  // è¦æœ›
  if (memo !== "") {
    text += "ã€è¦æœ›ã€‘\n" + memo + "\n";
  }

  saveHistory(text);

  // ------- Workerã¸é€ä¿¡ --------
  try {
    await fetch("https://odd-shape-3114.ashibinaa-izakaya.workers.dev/order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    alert("æ³¨æ–‡ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼");
    clearOrder();

  } catch(e) {
    alert("é€ä¿¡ã‚¨ãƒ©ãƒ¼ï¼ˆWorkerè¨­å®šã‚’ç¢ºèªï¼‰");
  }
}

/* ==========================================
   â–¼ æ³¨æ–‡ã‚¯ãƒªã‚¢
========================================== */
function clearOrder() {
  orderList = [];
  document.getElementById("orderList").innerHTML = "";
  document.querySelectorAll(".qty").forEach(q => q.textContent = "0");
  document.getElementById("memoBox").value = "";
}

/* ==========================================
   â–¼ å±¥æ­´ä¿å­˜
========================================== */
function saveHistory(txt) {
  let list = JSON.parse(localStorage.getItem("history") || "[]");
  list.push({ time: Date.now(), text: txt });
  localStorage.setItem("history", JSON.stringify(list));
  renderHistory();
}

/* ==========================================
   â–¼ å±¥æ­´è¡¨ç¤º
========================================== */
function renderHistory() {
  let list = JSON.parse(localStorage.getItem("history") || "[]");
  const box = document.getElementById("historyList");
  box.innerHTML = "";

  list.forEach(h => {
    const div = document.createElement("div");
    div.style.borderBottom = "1px solid #444";
    div.style.padding = "6px 0";
    div.innerText =
      new Date(h.time).toLocaleString() +
      "\n" +
      h.text;
    box.appendChild(div);
  });
}

/* ==========================================
   â–¼ PINãƒã‚§ãƒƒã‚¯ï¼ˆ5923ï¼‰
========================================== */
function checkPin() {
  const pin = document.getElementById("pinInput").value;

  if (pin === "5923") {
    document.getElementById("clearHistoryBtn").style.display = "block";
    alert("ç®¡ç†ãƒ¢ãƒ¼ãƒ‰ ON");
    document.getElementById("pinModal").style.display = "none";
  } else {
    alert("PINãŒé•ã„ã¾ã™");
  }
}

/* ==========================================
   â–¼ å±¥æ­´å‰Šé™¤
========================================== */
function clearHistory() {
  localStorage.removeItem("history");
  renderHistory();
  alert("å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã—ãŸ");
}

/* ==========================================
   â–¼ è¨€èªåˆ‡æ›¿ï¼ˆè¡¨ç¤ºã ã‘ï¼‰
========================================== */
function toggleLang() {
  currentLang = currentLang === "jp" ? "en" : "jp";
  document.getElementById("langToggle").innerText =
    currentLang === "jp" ? "EN" : "JP";

  menuData.forEach(m => {
    const id = "name-" + m.jp.replace(/[\s\(\)Â°ãƒ»]/g, "");
    const elem = document.getElementById(id);
    if (elem) elem.innerText = currentLang === "jp" ? m.jp : m.en;
  });
}

/* ==========================================
   â–¼ åˆæœŸåŒ–
========================================== */
document.addEventListener("DOMContentLoaded", () => {
  renderHistory();
  document.getElementById("langToggle").onclick = toggleLang;

  // å³ä¸Šã‚¿ãƒƒãƒ— â†’ PINèµ·å‹•ï¼ˆ3é€£ç¶šï¼‰
  let tap = 0;
  document.querySelector("header").addEventListener("click", () => {
    tap++;
    if (tap >= 3) {
      tap = 0;
      document.getElementById("pinModal").style.display = "flex";
    }
    setTimeout(() => tap = 0, 1200);
  });
});
</script>

</body>
</html>
